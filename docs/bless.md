这是一份极其详尽、**面向代码生成（Code-Generation Ready）** 的产品需求文档（PRD）。

你可以将以下内容直接丢给 Cursor、Windsurf 或 ChatGPT，并附带指令：“**我是开发者，请严格按照这份 PRD 为我的微信小程序开发‘新春祝福生成器’功能模块，包括前端 UI、逻辑处理和 AI 提示词集成。**”

---

# 🚀 产品需求文档 (PRD): 2026 马年“神仙祝福”生成器
# Feature: CNY Blessing Generator (2026 Horse Edition)

## 1. 核心定义 (Core Definition)
*   **功能目标**：解决春节期间“不知道发什么”和“发了怕尴尬”的社交痛点。通过 AI 生成针对不同关系（老板、亲戚、死党）的定制化、高情商或发疯文学祝福语，并支持生成精美海报。
*   **核心体验**：**Text First (文字即用)** + **Poster for Show (海报装逼)**。
*   **平台**：微信小程序 (WeChat Mini Program)。

---

## 2. 页面与 UI 详细设计 (UI Specifications)

### 2.1 首页入口改造 (Home Page Entry)
*   **布局变更**：将底部原本横排的 2 个入口改为 **Grid 宫格布局 (1行3列)**。
*   **样式**：
    *   容器：`display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;`
    *   **Item 1** (新增): `🧨 神仙祝福` (图标：红金配色的鞭炮或马头)
    *   **Item 2**: `🧧 妈妈存单`
    *   **Item 3**: `🐯 开运头像`
*   **微交互**：新增入口要有轻微的呼吸动效 (Scale animation)，提示用户点击。

### 2.2 生成器主页 (Main Page: `pages/blessing/index`)

页面背景色：浅米黄 (#FFF8F0)，顶部保留春节红 Navbar。

**区域 A：发送给谁？(Target Selector)**
*   组件：横向滚动列表 (ScrollView) 或 宫格选择 (Grid)。
*   选中态：高亮边框 + 红色对勾；未选中态：灰色边框。
*   **选项数据**：
    1.  `👔 给老板/甲方` (icon: 公文包)
    2.  `👵 给七大姑八大姨` (icon: 茶杯)
    3.  `🐷 给死党/闺蜜` (icon: 猪头/墨镜)
    4.  `❤️ 给对象/Crush` (icon: 爱心)
    5.  `🎓 给同学/前任` (icon: 柠檬)

**区域 B：想要什么味儿？(Vibe Slider)**
*   组件：分段控制器 (SegmentedControl) 或 3个互斥 Tag。
*   选项：
    *   `🍵 得体稳重` (安全牌)
    *   `🐴 马力全开` (全是马年谐音梗)
    *   `🌪 精神离家出走` (发疯文学/抽象)

**区域 C：行动按钮**
*   按钮文案：`✨ AI 帮我编 (点击生成)`
*   样式：大尺寸圆角按钮，带流光效果，阴影明显。

---

### 2.3 结果展示与交互页 (Result Page: Bottom Sheet / New Page)

当 AI 返回结果后，页面展示两个 Tab：**【文字版】** 和 **【海报版】**。

#### **Tab 1: 文字版 (Text Only - 效率优先)**
*   **布局**：中心是一个巨大的、像聊天气泡的卡片，显示 AI 生成的文本。
*   **操作区 (Action Bar)**：
    *   按钮 1 (次要): `🔄 不满意？重写` (逻辑：若今日免费次数用完，触发**激励视频广告**)。
    *   按钮 2 (核心): `📄 复制文本` (点击后 Toast 提示“已复制”)。
    *   按钮 3 (核心): `🚀 发给朋友` (调用 `<button open-type="share">`，直接唤起微信转发窗口，转发标题即为祝福语的前15个字)。

#### **Tab 2: 海报版 (Poster Mode - 裂变优先)**
*   **视觉风格**：复用之前的 **Nano Banana (微缩高亮)** 风格。
*   **组件**：Canvas 画布渲染预览图。
*   **海报元素构成**：
    1.  **背景**：
        *   *给老板*：红金渐变 (Red/Gold Gradient) - 大气。
        *   *给死党*：荧光黄/紫 (Banana/Neon) - 潮酷。
    2.  **装饰物 (Sticker)**：右上角放置 3D 质感的马头或元宝 (AI 生成素材)。
    3.  **主文案**：竖排或居中排版，大字号，字体推荐使用“演示佛系体”或手写体。
    4.  **底部**：小程序码 + 用户昵称 ("From: XXX 的新春祝福")。
*   **操作区**：
    *   按钮: `🖼 保存高清海报` (逻辑：检查是否已看广告/或是 VIP -> 调用 `wx.saveImageToPhotosAlbum`)。

---

## 3. AI 提示词工程 (System Prompt Design)

请将此 Prompt 结构直接写入代码中的 System Prompt 变量。

```javascript
const systemPrompt = `
你是一个【2026年丙午马年·春节社交嘴替大师】。
任务：根据用户选择的【发送对象】和【风格】，生成一段极其精准、有梗、符合人设的拜年文案。

[全局约束]
1. 时间背景：2026马年。必须包含至少一个“马”字谐音梗（如：一马当先、牛马、龙马精神、马到成功）。
2. 字数：30-50字之间（适合微信直接发，不折叠）。
3. 情绪：拒绝平庸的“万事如意”。要有情绪价值或社交功能。

[不同对象的策略库]
1. Target: **Boss (老板/甲方)**
   - 核心：把“马”和“业绩/领导力”绑定。暗戳戳表示自己想进步/要红包，但不卑微。
   - 风格示例：得体带梗。
   - 金句参考：“祝X总马年一马当先！跟着您这匹千里马，项目肯定一日千里。给您拜年啦！”

2. Target: **Relatives (亲戚 - 防御型)**
   - 核心：先发制人。用过度的热情堵住他们问“工资/对象”的嘴。
   - 风格示例：热情但废话多。
   - 金句参考：“二姨过年好！祝您马年打牌手气如烈马狂奔，拦都拦不住！广场舞稳坐C位！我先干为敬！”

3. Target: **Bestie (死党/闺蜜)**
   - 核心：发疯、搞钱、脱单。使用互联网黑话（吗喽/牛马/发财）。
   - 风格示例：抽象/精神状态领先。
   - 金句参考：“宝！祝你马年不做牛马，只做富婆！桃花运比马路还宽，钱多得要把马厩塞满！苟富贵勿相忘！”

4. Target: **Ex/Fake Friends (前任/塑料朋友)**
   - 核心：凡尔赛。暗示我过得非常好。
   - 金句参考：“新年快乐。今年忙着几个大项目马不停蹄，没顾上联系。祝你也能跟上我的节奏，马到成功哦。”
`;
```

---

## 4. 具体开发逻辑 (Dev Logic Specs)

### 4.1 数据结构 (Payload)
前端发送给 AI 的 JSON：
```json
{
  "target": "boss",      // 对应 prompt 策略
  "style": "funny",      // 对应 tone 调整
  "user_name": "张三"     // 可选，用于署名
}
```

### 4.2 海报绘制逻辑 (Canvas Drawing Logic)
*AI 辅助写代码时，请重点检查此段 Canvas 逻辑*：

1.  **准备画布**：创建 `OffscreenCanvas` (2d type)，尺寸建议 1080px * 1600px (9:16)。
2.  **绘制背景**：
    *   `ctx.fillStyle` = 根据 Target 换色。
    *   `boss` = `#A80000` (深红) -> `#FFD700` (金) 线性渐变。
    *   `bestie` = `#CCFF00` (荧光黄) -> `#FF00CC` (赛博紫) 线性渐变。
3.  **绘制装饰素材 (Image)**：
    *   调用 `wx.getImageInfo` 预加载云端的“3D马头素材”。
    *   `ctx.drawImage(horseImg, right, top)` 放在右上角做点缀。
4.  **绘制祝福语 (Text - 核心难点)**：
    *   需实现**自动换行**函数 `drawTextWrapped()`。
    *   设置 `ctx.font = 'bold 80px "PingFang SC"'`。
    *   `ctx.textAlign = 'center'`。
    *   文字必须垂直居中显示。
5.  **绘制底部 (Footer)**：
    *   画一个白色半透明圆角矩形作为底座。
    *   左侧：小程序码（需后端接口生成 `wxacode`）。
    *   右侧：文案 "By 春节嘴替 App"。

### 4.3 商业化广告埋点
1.  **广告位 ID**：在 `onLoad` 初始化 `RewardedVideoAd`。
2.  **逻辑判断**：
    *   `btnRegenerate.onTap`: 检查 `today_free_count`。如果 > 3，则调用 `ad.show()`。看完广告回调中 `fetchAI()`。
    *   `btnSavePoster.onTap`: 直接调用 `ad.show()` (定义为高级功能)。看完广告回调中调用 `canvasToTempFilePath` + `saveImage`。

---

## 5. 复制给 AI 的指令 (Copy this to AI)

> 作为一个全栈开发者，请根据以上《产品需求文档 (PRD)》帮我开发微信小程序。
> 1. 请写出 **Home 页面的 WXML/WXSS** 代码，将底部改为 3 列 Grid 布局。
> 2. 请写出 **Blessing 页面的 JS 核心逻辑**，包括选择 Target 后拼接 Prompt 调用 AI 的函数。
> 3. 请重点写出 **Canvas 海报绘制** 的逻辑代码，实现文字自动换行和图片合成。
> 4. 这里的 UI 风格必须沿用“Nano Banana”的高饱和度配色。

这样，你就拥有了一个逻辑严密、细节到像素级的产品设计，AI 接到这个文档后，生成的代码可用性会非常高！